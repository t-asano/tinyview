# Tiny View

Tiny Viewは、FPV映像を3画面同時に表示できるWebアプリです。USB接続型(UVC対応)のFPV受信機をPCに接続し、PCのブラウザでURLを開いて利用します。

<div align="center"><img alt="demo movie" src="https://github.com/t-asano/tinyview/raw/master/docs/img/demo.gif"></div>

## 動作環境

### 推奨環境

- MacBook Pro (Late 2016以降)
- MacOS High Sierra (10.13.2以降)
- Google Chrome (63.0.3239.108以降)

### 対応受信機

- Eachine ROTG01

### 備考

- Windowsでの動作は未検証です
- Chrome以外のブラウザでは、映像を1画面しか表示できない場合があります
- CPUやUSBインターフェースの能力が、表示の滑らかさに影響します
  - PCのUSBポートにFPV受信機を直結すると、改善する場合があります
  - 画質を落として安定動作を狙う「安定化モード」も利用できます
- Eachine ROTG02 にも対応予定です

## インストールと起動

### デモサイトを利用する場合

デモサイトで動作を試すことができます。ただし、動作のカスタマイズはできません。映像がインターネットへ送信されることはありませんので、ご安心ください。

#### 1. カメラの許可設定(初回のみ)

1. Chromeでデモサイト https://t-asano.github.io/tinyview/ に接続
2. Webアドレスの左に表示されているアイコンをクリック
3. [サイトの設定]をクリック
4. [カメラ]を[許可]に設定
5. Webサイトをリロード

#### 2. 起動

1. FPV受信機を接続
2. Chromeでデモサイト https://t-asano.github.io/tinyview/ に接続

### PC上に設置する場合

Node.jsを導入済みのPCにWebサーバーを設置します。この場合、動作を自由にカスタマイズできます。

#### 1. インストール(初回のみ)

1. 適当な場所にファイル一式を配置
2. 外部モジュールをインストール ($ npm install)

#### 2. カメラの許可設定(初回のみ)

1. サーバーを起動 ($ node index.js)
2. Chromeで http://localhost:3001 に接続
3. Webアドレスの左に表示されているアイコンをクリック
4. [サイトの設定]をクリック
5. [カメラ]を[許可]に設定
6. Webサイトをリロード

#### 3. 起動

1. サーバーを起動 ($ node index.js)
2. FPV受信機を接続
3. Chromeで http://localhost:3001 に接続

## 安定化モード

URLの最後に "?s" または "?mode=stability" を加えると、安定化モードで動作します。このモードでは、映像の解像度及びフレームレートを低くする事で表示負荷を減らし、安定した表示を狙います。

モード毎の設定値は以下のとおりです。

| モード | 解像度(横方向) | フレームレート |
|:--|:--|:--|
| 標準モード | 640 px 以下 | 32 fps 以下 |
| 安定化モード | 352 px 以下 | 16 fps 以下 |

Eachine ROTG01では、以下のような動作が期待できます。

| モード | 解像度 | フレームレート |
|:--|:--|:--|
| 標準モード | 640 × 480 px | 30 fps |
| 安定化モード | 352 x 288 px | 15 fps |

## 操作方法

キーボード操作により、映像を個別にON/OFFできます。

- 1キー：映像1をON/OFFする
- 2キー：映像2をON/OFFする
- 3キー：映像3をON/OFFする

## カスタマイズ

PC上にWebサーバーを設置した場合には、自由にカスタマイズが可能です。

設定ファイル(docs/config.js)を書き換えることで、以下の項目をカスタマイズできます。

- タイトル
- 背景画像
- 選手画像
- 選手名

また、プログラムファイル(docs/main.js)を書き換えることで、UVC対応の一般的なUSBカメラも利用可能となります。プログラム中の以下の条件式に、利用したい映像機器のラベルを加えてください(ラベルはコンソールで確認できます)。

> if (dev.label.indexOf('USB2.0 PC CAMERA') !== -1) {

これにより、FPV受信機とPC内蔵カメラの映像を混在させるような使い方も可能です。映像機器は、プログラムが検出した順に3台まで使用されます。

## ライセンス

MIT License
